#Set loot tables for mob variants
#Cat
data merge entity @e[type=ocelot,tag=!head_updated,nbt={CatType:0},sort=nearest,limit=1] {DeathLootTable:"heads:entities/cat/ocelot",Tags:["head_updated"]}
data merge entity @e[type=ocelot,tag=!head_updated,nbt={CatType:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/cat/black_cat",Tags:["head_updated"]}
data merge entity @e[type=ocelot,tag=!head_updated,nbt={CatType:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/cat/ginger_cat",Tags:["head_updated"]}
data merge entity @e[type=ocelot,tag=!head_updated,nbt={CatType:3},sort=nearest,limit=1] {DeathLootTable:"heads:entities/cat/siamese_cat",Tags:["head_updated"]}
#Creeper
data merge entity @e[type=creeper,tag=!head_updated,nbt={powered:1b},sort=nearest,limit=1] {DeathLootTable:"heads:entities/creeper/charged_creeper",Tags:["head_updated"]}
#Horse
data merge entity @e[type=horse,tag=!head_updated,nbt={Variant:0},sort=nearest,limit=1] {DeathLootTable:"heads:entities/horse/white_horse",Tags:["head_updated"]}
data merge entity @e[type=horse,tag=!head_updated,nbt={Variant:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/horse/golden_horse",Tags:["head_updated"]}
data merge entity @e[type=horse,tag=!head_updated,nbt={Variant:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/horse/chestnut_horse",Tags:["head_updated"]}
data merge entity @e[type=horse,tag=!head_updated,nbt={Variant:3},sort=nearest,limit=1] {DeathLootTable:"heads:entities/horse/brown_horse",Tags:["head_updated"]}
data merge entity @e[type=horse,tag=!head_updated,nbt={Variant:4},sort=nearest,limit=1] {DeathLootTable:"heads:entities/horse/black_horse",Tags:["head_updated"]}
data merge entity @e[type=horse,tag=!head_updated,nbt={Variant:5},sort=nearest,limit=1] {DeathLootTable:"heads:entities/horse/gray_horse",Tags:["head_updated"]}
data merge entity @e[type=horse,tag=!head_updated,nbt={Variant:6},sort=nearest,limit=1] {DeathLootTable:"heads:entities/horse/dark_horse",Tags:["head_updated"]}
#Llama
data merge entity @e[type=llama,tag=!head_updated,nbt={Variant:0},sort=nearest,limit=1] {DeathLootTable:"heads:entities/llama/creamy_llama",Tags:["head_updated"]}
data merge entity @e[type=llama,tag=!head_updated,nbt={Variant:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/llama/white_llama",Tags:["head_updated"]}
data merge entity @e[type=llama,tag=!head_updated,nbt={Variant:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/llama/brown_llama",Tags:["head_updated"]}
data merge entity @e[type=llama,tag=!head_updated,nbt={Variant:3},sort=nearest,limit=1] {DeathLootTable:"heads:entities/llama/gray_llama",Tags:["head_updated"]}
#Parrot
data merge entity @e[type=parrot,tag=!head_updated,nbt={Variant:0},sort=nearest,limit=1] {DeathLootTable:"heads:entities/parrot/red_parrot",Tags:["head_updated"]}
data merge entity @e[type=parrot,tag=!head_updated,nbt={Variant:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/parrot/blue_parrot",Tags:["head_updated"]}
data merge entity @e[type=parrot,tag=!head_updated,nbt={Variant:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/parrot/green_parrot",Tags:["head_updated"]}
data merge entity @e[type=parrot,tag=!head_updated,nbt={Variant:3},sort=nearest,limit=1] {DeathLootTable:"heads:entities/parrot/cyan_parrot",Tags:["head_updated"]}
data merge entity @e[type=parrot,tag=!head_updated,nbt={Variant:4},sort=nearest,limit=1] {DeathLootTable:"heads:entities/parrot/gray_parrot",Tags:["head_updated"]}
#Rabbit
data merge entity @e[type=rabbit,tag=!head_updated,nbt={CustomName:"{\"text\":\"Toast\"}"},sort=nearest,limit=1] {DeathLootTable:"heads:entities/rabbit/toast_rabbit",Tags:["head_updated"]}
data merge entity @e[type=rabbit,tag=!head_updated,nbt={RabbitType:0},sort=nearest,limit=1] {DeathLootTable:"heads:entities/rabbit/brown_rabbit",Tags:["head_updated"]}
data merge entity @e[type=rabbit,tag=!head_updated,nbt={RabbitType:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/rabbit/white_rabbit",Tags:["head_updated"]}
data merge entity @e[type=rabbit,tag=!head_updated,nbt={RabbitType:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/rabbit/black_rabbit",Tags:["head_updated"]}
data merge entity @e[type=rabbit,tag=!head_updated,nbt={RabbitType:3},sort=nearest,limit=1] {DeathLootTable:"heads:entities/rabbit/splotched_rabbit",Tags:["head_updated"]}
data merge entity @e[type=rabbit,tag=!head_updated,nbt={RabbitType:4},sort=nearest,limit=1] {DeathLootTable:"heads:entities/rabbit/gold_rabbit",Tags:["head_updated"]}
data merge entity @e[type=rabbit,tag=!head_updated,nbt={RabbitType:5},sort=nearest,limit=1] {DeathLootTable:"heads:entities/rabbit/pepper_rabbit",Tags:["head_updated"]}
data merge entity @e[type=rabbit,tag=!head_updated,nbt={RabbitType:99},sort=nearest,limit=1] {DeathLootTable:"heads:entities/rabbit/killer_bunny",Tags:["head_updated"]}
#Sheep
data merge entity @e[type=sheep,tag=!head_updated,nbt={CustomName:"{\"text\":\"jeb_\"}"},sort=nearest,limit=1] {DeathLootTable:"heads:entities/sheep/jeb_sheep",Tags:["head_updated"]}
#Villager
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:0,Career:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/farmer/farmer",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:0,Career:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/farmer/fisherman",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:0,Career:3},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/farmer/shepherd",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:0,Career:4},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/farmer/fletcher",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:1,Career:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/librarian/librarian",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:1,Career:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/librarian/cartographer",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/cleric",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:3,Career:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/blacksmith/armourer",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:3,Career:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/blacksmith/weaponsmith",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:3,Career:3},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/blacksmith/toolsmith",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:4,Career:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/butcher/butcher",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:4,Career:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/butcher/leatherworker",Tags:["head_updated"]}
data merge entity @e[type=villager,tag=!head_updated,nbt={Profession:5},sort=nearest,limit=1] {DeathLootTable:"heads:entities/villager/nitwit",Tags:["head_updated"]}
#Wither
data merge entity @e[type=wither,tag=!head_updated,sort=nearest,limit=1] {DeathLootTable:"heads:entities/wither/wither",Tags:["head_updated"]}
#Zombie Villager
data merge entity @e[type=zombie_villager,tag=!head_updated,nbt={Profession:0},sort=nearest,limit=1] {DeathLootTable:"heads:entities/zombie_villager/zombie_farmer",Tags:["head_updated"]}
data merge entity @e[type=zombie_villager,tag=!head_updated,nbt={Profession:1},sort=nearest,limit=1] {DeathLootTable:"heads:entities/zombie_villager/zombie_librarian",Tags:["head_updated"]}
data merge entity @e[type=zombie_villager,tag=!head_updated,nbt={Profession:2},sort=nearest,limit=1] {DeathLootTable:"heads:entities/zombie_villager/zombie_cleric",Tags:["head_updated"]}
data merge entity @e[type=zombie_villager,tag=!head_updated,nbt={Profession:3},sort=nearest,limit=1] {DeathLootTable:"heads:entities/zombie_villager/zombie_smith",Tags:["head_updated"]}
data merge entity @e[type=zombie_villager,tag=!head_updated,nbt={Profession:4},sort=nearest,limit=1] {DeathLootTable:"heads:entities/zombie_villager/zombie_butcher",Tags:["head_updated"]}
data merge entity @e[type=zombie_villager,tag=!head_updated,nbt={Profession:5},sort=nearest,limit=1] {DeathLootTable:"heads:entities/zombie_villager/zombie_nitwit",Tags:["head_updated"]}

#Give mined custom heads back their title
# * The following commands cause the most strain on the server, so optimise them!
# 1. data merge entity @e[sort=nearest,limit=1] > execute as @e[] run data merge entity @s
# * Since we only expext one item to be found occasionally we can assume that the @e[limit=1] selector does not slow down execution
# 2. Split into 40ths so each command runs once every 40 ticks and load is distributed across the server (Item PickupDelay is 40 ticks so no chance of item data not updating in time)

data merge entity @e[type=item,tag=!head_updated,nbt={Item:{id:"minecraft:player_head"}},sort=nearest,limit=1] {PickupDelay: 40s, Tags:[head_updated]}

execute if score ticks_fourtieths ticks_fourtieths matches 0 run function heads:custom_heads/ticked/ticked0
execute if score ticks_fourtieths ticks_fourtieths matches 1 run function heads:custom_heads/ticked/ticked1
execute if score ticks_fourtieths ticks_fourtieths matches 2 run function heads:custom_heads/ticked/ticked2
execute if score ticks_fourtieths ticks_fourtieths matches 3 run function heads:custom_heads/ticked/ticked3
execute if score ticks_fourtieths ticks_fourtieths matches 4 run function heads:custom_heads/ticked/ticked4
execute if score ticks_fourtieths ticks_fourtieths matches 5 run function heads:custom_heads/ticked/ticked5
execute if score ticks_fourtieths ticks_fourtieths matches 6 run function heads:custom_heads/ticked/ticked6
execute if score ticks_fourtieths ticks_fourtieths matches 7 run function heads:custom_heads/ticked/ticked7
execute if score ticks_fourtieths ticks_fourtieths matches 8 run function heads:custom_heads/ticked/ticked8
execute if score ticks_fourtieths ticks_fourtieths matches 9 run function heads:custom_heads/ticked/ticked9
execute if score ticks_fourtieths ticks_fourtieths matches 10 run function heads:custom_heads/ticked/ticked10
execute if score ticks_fourtieths ticks_fourtieths matches 11 run function heads:custom_heads/ticked/ticked11
execute if score ticks_fourtieths ticks_fourtieths matches 12 run function heads:custom_heads/ticked/ticked12
execute if score ticks_fourtieths ticks_fourtieths matches 13 run function heads:custom_heads/ticked/ticked13
execute if score ticks_fourtieths ticks_fourtieths matches 14 run function heads:custom_heads/ticked/ticked14
execute if score ticks_fourtieths ticks_fourtieths matches 15 run function heads:custom_heads/ticked/ticked15
execute if score ticks_fourtieths ticks_fourtieths matches 16 run function heads:custom_heads/ticked/ticked16
execute if score ticks_fourtieths ticks_fourtieths matches 17 run function heads:custom_heads/ticked/ticked17
execute if score ticks_fourtieths ticks_fourtieths matches 18 run function heads:custom_heads/ticked/ticked18
execute if score ticks_fourtieths ticks_fourtieths matches 19 run function heads:custom_heads/ticked/ticked19
execute if score ticks_fourtieths ticks_fourtieths matches 20 run function heads:custom_heads/ticked/ticked20
execute if score ticks_fourtieths ticks_fourtieths matches 21 run function heads:custom_heads/ticked/ticked21
execute if score ticks_fourtieths ticks_fourtieths matches 22 run function heads:custom_heads/ticked/ticked22
execute if score ticks_fourtieths ticks_fourtieths matches 23 run function heads:custom_heads/ticked/ticked23
execute if score ticks_fourtieths ticks_fourtieths matches 24 run function heads:custom_heads/ticked/ticked24
execute if score ticks_fourtieths ticks_fourtieths matches 25 run function heads:custom_heads/ticked/ticked25
execute if score ticks_fourtieths ticks_fourtieths matches 26 run function heads:custom_heads/ticked/ticked26
execute if score ticks_fourtieths ticks_fourtieths matches 27 run function heads:custom_heads/ticked/ticked27
execute if score ticks_fourtieths ticks_fourtieths matches 28 run function heads:custom_heads/ticked/ticked28
execute if score ticks_fourtieths ticks_fourtieths matches 29 run function heads:custom_heads/ticked/ticked29
execute if score ticks_fourtieths ticks_fourtieths matches 30 run function heads:custom_heads/ticked/ticked30
execute if score ticks_fourtieths ticks_fourtieths matches 31 run function heads:custom_heads/ticked/ticked31
execute if score ticks_fourtieths ticks_fourtieths matches 32 run function heads:custom_heads/ticked/ticked32
execute if score ticks_fourtieths ticks_fourtieths matches 33 run function heads:custom_heads/ticked/ticked33
execute if score ticks_fourtieths ticks_fourtieths matches 34 run function heads:custom_heads/ticked/ticked34
execute if score ticks_fourtieths ticks_fourtieths matches 35 run function heads:custom_heads/ticked/ticked35
execute if score ticks_fourtieths ticks_fourtieths matches 36 run function heads:custom_heads/ticked/ticked36
execute if score ticks_fourtieths ticks_fourtieths matches 37 run function heads:custom_heads/ticked/ticked37
execute if score ticks_fourtieths ticks_fourtieths matches 38 run function heads:custom_heads/ticked/ticked38
execute if score ticks_fourtieths ticks_fourtieths matches 39 run function heads:custom_heads/ticked/ticked39